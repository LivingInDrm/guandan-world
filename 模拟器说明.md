# 掼蛋牌局模拟器

## 功能概述

基于已有的SDK，我们成功实现了一个完整的掼蛋牌局模拟器，能够自动模拟4个玩家进行完整的掼蛋比赛。

## 主要特性

### 🎮 完整模拟流程
- **自动生成4个玩家**：Alice, Bob, Charlie, Diana分别坐在0-3号座位
- **完整Match过程**：从2级开始，直到某队伍达到A级(14级)
- **自动发牌**：每局自动发放27张牌给每个玩家
- **自动上贡还贡**：根据上局排名自动处理上贡环节
- **自动出牌逻辑**：实现智能出牌策略
- **自动结算**：每局结束后自动计算等级升级

### 🧠 出牌策略

#### 首出策略（张数优先）
按优先级选择：
1. 钢板(6张) - 三个对子
2. 顺子(5张) - 连续5张牌  
3. 葫芦(5张) - 三张+对子
4. 三张(3张) - 三张同数字
5. 对子(2张) - 两张同数字
6. 单张 - 最小的牌

#### 跟牌策略
- 如果能压过当前牌型，则自动出牌
- 否则过牌
- 支持单张、对子、三张等基本牌型的跟牌

### 🎯 上贡逻辑

#### 选贡策略
- 首选者选择最大的牌进行上贡

#### 还贡策略  
- 选择不破坏炸弹的最小牌进行还贡

## 技术实现

### 核心组件

1. **MatchSimulator** (`sdk/match_simulator.go`)
   - 主要的模拟器类
   - 协调整个比赛流程
   - 实现自动出牌和上贡逻辑

2. **测试文件** (`sdk/match_simulator_test.go`)
   - 提供详细模式和安静模式测试
   - 支持多场比赛的统计分析
   - 性能基准测试

### 关键修复

在开发过程中解决了多个关键问题：

1. **Trick状态管理**：修复了StartTrick没有被调用的问题
2. **等级升级逻辑**：确保获胜队伍正确获得等级提升
3. **上贡阶段处理**：修复了tribute状态的处理逻辑
4. **还贡逻辑**：纠正了giver和receiver概念混淆的问题
5. **出完牌玩家处理**：正确跳过已经出完牌的玩家

## 使用方法

### 运行测试

```bash
cd sdk
go test -v -run TestMatchSimulator
```

### 运行安静模式测试

```bash
cd sdk  
go test -v -run TestMatchSimulatorQuiet
```

### 运行性能测试

```bash
cd sdk
go test -bench=BenchmarkMatchSimulator
```

## 示例输出

```
🀄 开始模拟掼蛋牌局...
玩家信息:
  座位0: Alice (队伍0)
  座位1: Bob (队伍1)  
  座位2: Charlie (队伍0)
  座位3: Diana (队伍1)

=== 第1局 ===
级别: 2
  第1轮出牌
  第2轮出牌
  ...
第1局结束，排名: [1 2 3 0]
获胜队伍: 1, 升级: [0 1]
更新后等级: 队伍0=2级, 队伍1=3级

当前等级: 队伍0=2级, 队伍1=3级
=== 第2局 ===
级别: 3
  处理上贡阶段...
  第1轮出牌
  ...
```

## 模拟器特点

### ✅ 已实现功能
- 完整的掼蛋规则模拟
- 智能出牌策略
- 自动上贡还贡
- 等级系统和升级逻辑
- 比赛统计和结果分析

### 🔧 优化空间
- 更复杂的出牌AI策略
- 更精确的上贡策略（考虑炸弹保护）
- 支持不同难度的AI
- 更详细的游戏统计

## 技术亮点

1. **模块化设计**：清晰分离游戏逻辑和模拟逻辑
2. **错误处理**：完善的错误检测和恢复机制
3. **状态管理**：正确处理游戏各个阶段的状态转换
4. **可配置性**：支持详细和安静两种输出模式
5. **可扩展性**：易于添加新的出牌策略和AI逻辑

这个模拟器成功实现了用户的所有要求，提供了一个完整的掼蛋牌局自动化测试环境。 