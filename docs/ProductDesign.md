# 掼蛋在线对战游戏 PRD

## 1. 产品概览

**产品名称**：掼蛋在线对战平台
**版本**：v1.0 MVP
**目标用户**：喜爱掼蛋的线上玩家（尤其是有线下经验的用户）
**核心目标**：支持用户登录注册，创建房间加入游戏、房主控制游戏开始、四人对战完整流程，包括发牌、出牌、结算、升级。

---

## 3. 功能模块设计

### 3.1 登录 / 注册

* 登录、注册功能，注册后自动登录，登录后跳转至房间大厅

### 3.2 房间大厅

* 展示所有在线房间（状态：等待中 / 游戏中）；展示房间列表的顺序，等待中房间优先，已加入的用户人数越多越优先。列表要分段加载（每次 12 个），以提升加载的性能
* 每个房间上展示：建议 / 已加入人数 / 已加入的用户名及其座次
* 每个房间下方有加入按钮，如果房间人数未满且游戏未开始，则该按钮可点击；否则置灰不可点。点击后可加入房间
* 房间大厅上方有“创建新房间”按钮，点击可创建新房间

### 3.3 房间内（等待状态）

* 用户进入后自动分配 Seat （0 \~ 3）
* 创建者设为房主；房主界面显示“开始游戏”按钮，默认置灰，当人数达 4 人时变为可点击，房主可点击开始游戏
* 若游戏未开始，用户可主动退出或关闭页面自动退出；房主若退出，则随机选择玩家为新房主；最后一个玩家退出时房间自动关闭

### 3.4 游戏开始与 Match 流程

#### 3.4.1 开始游戏

* 房主点击“开始游戏”，人数检查为 4 人
* 所有玩家同步进入准备页，3 秒倒计时后进入牌局页

#### 3.4.2 每局牌的三个阶段

##### 1. 准备页面

**发牌阶段**

**上贡 + 免贡判定阶段**

* 展示上贡及免贡信息：

  * **免贡**：a 用户因满足 xxx 条件予以免贡；或 a 用户不满足免贡条件，要上贡
  * **上贡**：a 用户 + b 用户要给 c 用户 + b 用户上贡
* **上贡组件**：

  * 双下：提供贡池，由胜方两人先后选择；Rank 1 有 3 秒选择时间，Rank 2 自动选择剩余牌，并在原牌上方标记领贡用户名
  * 非双下：仅展示一张贡，展示 3 秒后自动上贡
* **还贡组件**：自动还给对应用户，并在贡池区公示 3 秒
* 从后端获取先出牌者，进入下一阶段
* 显示级牌 / 当前局数 / 队伍分配 / 倒计时提示

##### 2. 出牌页面（主 UI）

* **level 显示组件**：显示两个队伍的当前 level 及当前牌局的 level，位于左上角
* **玩家手牌区组件**（位于下半部分）：

  * 按点数分组，相同点数为一组，对所有组按点数排序
  * **横向**：左→右展示点数从大到小的分组（Joker > Trump > A > J > 9 > 2）
  * **纵向**：组内纵向堆叠；同点数按花色优先级叠放（Joker > Heart > Club > Spade > Diamond）；同点同花色可能出现两张，依次向下叠放
* **牌局出牌区组件**（显示每用户在当前 Trick 中的状态，仅五种）：

  * 已过牌：显示 Pass
  * 正在等待出牌：显示计时器，限 20 秒（由后端配置），超时自动 Pass
  * 已出牌：显示出牌
  * 未轮到：显示 Waiting
  * 该 Deal 已结束：显示玩家排名
* **出牌区位置**：

  * 当前玩家出牌区在页面下方
  * 其余三位玩家的出牌区按顺时针依次排在左侧、上方、右侧
  * 每个出牌区上方显示用户名及剩余牌张数（若进入 report 状态）
* **当前玩家出牌动作组件**（轮到当前用户时显示）：

  * **出牌**：选择牌后点击“出牌”
  * **不出**：点击“不出”直接 Pass
  * **倒计时**：20 秒出牌限制

##### 3. 结算页面（Deal）

* **Deal 结算组件**：

  * 展示出完牌顺序（Rank 1 \~ 4），注意分队显示
  * 判断胜方队伍 / 胜利类型，分队显示升级结果（+3 / +2 / +1）
  * Deal 启动时间、持续时间
* **Match 结束**：页面下方显示 Match 结算组件

  * 显示两队成员、各自 Level、Match 启动时间、持续时间
* **Deal 结束操作组件**：

  * **继续**：继续当前 Match
  * **退出**：退出房间回大厅；当前 Match 结束，玩家位置释放，房间转为待开始状态
* 判断是否达到 A 级：

  * 若达到：显示最终比分、胜负队伍、返回大厅
  * 否则：更新 Level，开始下一局

---

## 4. 关键交互规则

* **用户断线**：自动标记托管，牌局继续；若该用户成 Trick Leader，则默认打出当前最小牌；否则默认 Pass
* **游戏中房间**：禁止新用户加入
* **操作卡顿保护**：每轮操作默认 15 秒倒计时，超时自动 Pass；连续 2 次超时，用户变为托管状态
