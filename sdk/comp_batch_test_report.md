# 掼蛋牌型识别批量测试报告

## 测试概览

- **测试数据来源**: `test-data/comp.json`
- **测试级别**: 5 (红桃5为变化牌)
- **总测试用例数**: 105
- **通过测试**: 89 个 (84.8%)
- **失败测试**: 16 个 (15.2%)

## 测试结果统计

### 按牌型分类的测试结果

| 牌型 | 期望 | 实际通过 | 失败 | 成功率 |
|------|------|----------|------|---------|
| Single | 3 | 3 | 0 | 100% |
| Pair | 7 | 7 | 0 | 100% |
| Triple | 6 | 6 | 0 | 100% |
| FullHouse | 10 | 10 | 0 | 100% |
| Straight | 24 | 16 | 8 | 66.7% |
| StraightFlush | 5 | 2 | 3 | 40% |
| Plate | 9 | 5 | 4 | 55.6% |
| Tube | 9 | 8 | 1 | 88.9% |
| NaiveBomb | 9 | 9 | 0 | 100% |
| JokerBomb | 1 | 1 | 0 | 100% |
| IllegalComp | 21 | 21 | 0 | 100% |
| Fold | 1 | 1 | 0 | 100% |

## 主要问题分析

### 1. 顺子识别问题

**问题**: A 在顺子中的处理不正确
- A 在顺子中需要支持循环，既可以作为 1 (A-2-3-4-5)，也可以作为 14 (10-J-Q-K-A)
- 当前实现只考虑了 A 作为 1 的情况，没有处理 A 作为 14 的情况

**失败的顺子用例**:
- `[A, J, Q, K, 10]` -> 应该是 10-J-Q-K-A 顺子
- `[A, J, Q, K, 5]` -> 应该是 10-J-Q-K-A 顺子（5为变化牌）
- `[Q, K, A, 5, 5]` -> 应该是 Q-K-A-2-3 顺子（5为变化牌）

### 2. 钢板识别问题

**问题**: 连续性判断不正确
- A-2 应该是连续的（A 作为 1，2 作为 2）
- 当前实现中 A 的 Number 是 14，导致 14-2 不连续

**失败的钢板用例**:
- `[A, A, A, 2, 2, 2]` -> 应该是 A-2 连续的钢板
- `[A, A, 5, 2, 2, 2]` -> 应该是 A-2 连续的钢板（5为变化牌）

### 3. 钢管识别问题

**问题**: 类似钢板的连续性问题
- 需要正确处理 A 在钢管中的连续性

**失败的钢管用例**:
- `[J, K, J, K, 5, 5]` -> 应该是 J-Q-K 连续的钢管（5为变化牌）
- `[A, K, A, K, 5, 5]` -> 应该是 K-A-2 连续的钢管（5为变化牌）

### 4. 同花顺识别问题

**问题**: 继承了顺子的问题
- 同花顺依赖于顺子的判断，所以顺子的问题也会影响同花顺

## 建议的修复方案

### 1. 修复顺子识别
- 在顺子判断中，需要考虑 A 的双重身份
- 检查两种情况：A 作为 1 和 A 作为 14
- 优化 `checkStraightValid` 函数

### 2. 修复钢板识别
- 在钢板判断中，使用 RawNumber 而不是 Number 来判断连续性
- 或者添加特殊处理来处理 A-2 的连续性

### 3. 修复钢管识别
- 类似钢板的修复方案
- 确保 A 在钢管中的连续性判断正确

## 测试用例详情

### 失败的测试用例列表
1. 用例 40: Tube -> Plate (钢管被识别为钢板)
2. 用例 44: Plate -> IllegalComp (A-2 钢板未识别)
3. 用例 46: Plate -> IllegalComp (A-2 钢板未识别)
4. 用例 48: Plate -> IllegalComp (A-2 钢板未识别)
5. 用例 49: Plate -> IllegalComp (A-2 钢板未识别)
6. 用例 51: Straight -> IllegalComp (A-J-Q-K-10 顺子未识别)
7. 用例 53: Straight -> IllegalComp (A-J-Q-K-5 顺子未识别)
8. 用例 58: Straight -> IllegalComp (Q-K-A-5-5 顺子未识别)
9. 用例 72: Straight -> IllegalComp (J-K-A-5-5 顺子未识别)
10. 用例 73: Straight -> IllegalComp (J-Q-A-5-5 顺子未识别)
11. 用例 79: Tube -> IllegalComp (J-K 钢管未识别)
12. 用例 80: Tube -> Plate (A-K 钢管被识别为钢板)
13. 用例 98: Straight -> IllegalComp (10-A-K-5-5 顺子未识别)
14. 用例 99: StraightFlush -> IllegalComp (10-A-K-5-5 同花顺未识别)
15. 用例 100: StraightFlush -> IllegalComp (10-A-J-5-5 同花顺未识别)
16. 用例 101: Straight -> IllegalComp (10-A-J-5-5 顺子未识别)

## 结论

当前的牌型识别系统在基础牌型（单张、对子、三张、葫芦、炸弹等）上表现良好，但在需要处理连续性的复杂牌型（顺子、钢板、钢管、同花顺）上存在问题，特别是对 A 的特殊处理不够完善。

建议优先修复顺子识别问题，因为这是影响最大的问题（影响了顺子和同花顺的识别）。然后再处理钢板和钢管的连续性问题。 